<% include ./partials/start%>

<div class="col-md-12 col-sm-12 col-xs-12">
    <div class="x_panel">
        <% if (typeof message!== 'undefined'){ %>
        <div class="alert <%=message.kind%> fade in">
            <strong>  <%=message.content%></strong>
        </div>
        <%}%>
<div class="row">
    <div class="col-md-12">
        <div class="x_panel">

            <div class="x_content">


                <!-- start project list -->
                <table id="datatable-responsive" class="table table-striped table-bordered dt-responsive nowrap"
                       cellspacing="0" width="100%">                      <thead>
                    <tr>
                        <th style="width: 9%">شماره قرارداد</th>
                        <th style="width: 15%">نام مدیر</th>
                        <th style="width: 15%">شماره همراه </th>
                        <th style="width: 20%">آدرس </th>
                        <th style="width: 20%">پیشرفت پروژه</th>
                        <th style="width: 10%">وضعیت</th>
                        <th style="width: 20%">عملیات</th>
                    </tr>
                    </thead>
                    <tbody>
                    <% for(i=0;i < contract.length;i++){ %>
                    <tr>
                        <td><%=contract[i]._id%></td>
                        <td>
                            <a><%=contract[i].requester%></a>
                            <br/>
                            <small>تاریخ عقد قرارداد <span class="jalali"><%=contract[i].created%></span> </small>
                        </td>
                        <td><%=contract[i].phone%></td>
                        <td><%=contract[i].address%></td>
                        <%var timeDiff = Math.abs(contract[i].contractenddate.getTime() - contract[i].contractduration.getTime());
                        var now=new Date();
                        console.log(timeDiff);
                        var timeDiff1 = Math.abs(contract[i].contractenddate.getTime() - now.getTime());
                        var darsad=100-(timeDiff1*100)/timeDiff;
                        if(darsad<0) {darsad=100; var active="0";}
                        else
                        var active="1";
                        var diffDays = Math.ceil(darsad / (1000 * 3600 * 24));%>
                        <td class="project_progress">
                            <div class="progress progress_sm">
                                <div class="progress-bar bg-green" role="progressbar"
                                     data-transitiongoal="<%=Math.round(darsad)%>%"></div>
                            </div>
                            <small>
                                <%=Math.round(darsad)%>%
                                سپری شده</small>
                        </td>
                        <td>
                            <%if(typeof contract[i].status!=='undefined'){%>
                            <% if(active==="1") {%><button type="button" class="btn btn-success btn-xs"> فعال</button><%}else{%><button type="button" class="btn btn-dark btn-xs">منقضی</button> <%}%>
                            <%}else {%>
                                <button type="button" class="btn btn-danger btn-xs">غیر فعال</button>
                            <%}%>
                        </td>
                        <td class="nowrap">
                            <%if(typeof contract[i].status==='undefined'){%>
                            <% if(active==="1") {%>
                            <a href="add_contract?cid=<%=contract[i]._id%>" class="btn btn-info btn-xs"><i class="fa fa-pencil"></i> ویرایش </a>
                            <a href="#" class="btn btn-danger btn-xs"><i class="fa fa-trash-o"></i> لغو </a>
                            <%}}%>
                        </td>
                    </tr>
                    <%}%>
                    </tbody>
                </table>
                <!-- end project list -->

            </div>
        </div>
    </div>
</div>
</div>
</div>

</div>
    </div>
</div>
</div>


</div>
</div>
<% include ./partials/footer%>

</div>


<!-- jQuery -->
<script src="../vendors/jquery/dist/jquery.min.js"></script>
<!-- Bootstrap -->
<script src="../vendors/bootstrap/dist/js/bootstrap.min.js"></script>
<!-- FastClick -->
<script src="../vendors/fastclick/lib/fastclick.js"></script>
<!-- NProgress -->
<script src="../vendors/nprogress/nprogress.js"></script>
<!-- bootstrap-progressbar -->
<script src="../vendors/bootstrap-progressbar/bootstrap-progressbar.min.js"></script>
<!-- iCheck -->
<script src="../vendors/iCheck/icheck.min.js"></script>

<!-- bootstrap-daterangepicker -->
<script src="../vendors/moment/min/moment.min.js"></script>
<script src="../js/moment-jalaali.js"></script>
<script src="../vendors/bootstrap-daterangepicker/daterangepicker.js"></script>
<!-- Datatables -->
<script src="../vendors/datatables.net/js/jquery.dataTables.min.js"></script>
<script src="../vendors/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
<script src="../vendors/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
<script src="../vendors/datatables.net-buttons-bs/js/buttons.bootstrap.min.js"></script>
<script src="../vendors/datatables.net-buttons/js/buttons.flash.min.js"></script>
<script src="../vendors/datatables.net-buttons/js/buttons.html5.min.js"></script>
<script src="../vendors/datatables.net-buttons/js/buttons.print.min.js"></script>
<script src="../vendors/datatables.net-fixedheader/js/dataTables.fixedHeader.min.js"></script>
<script src="../vendors/datatables.net-keytable/js/dataTables.keyTable.min.js"></script>
<script src="../vendors/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
<script src="../vendors/datatables.net-responsive-bs/js/responsive.bootstrap.js"></script>
<script src="../vendors/datatables.net-scroller/js/dataTables.scroller.min.js"></script>
<script src="../vendors/jszip/dist/jszip.min.js"></script>
<script src="../vendors/pdfmake/build/pdfmake.min.js"></script>
<script src="../vendors/pdfmake/build/vfs_fonts.js"></script>
<!-- bootstrap-wysiwyg -->
<script src="../vendors/bootstrap-wysiwyg/js/bootstrap-wysiwyg.min.js"></script>
<script src="../vendors/jquery.hotkeys/jquery.hotkeys.js"></script>
<script src="../vendors/google-code-prettify/src/prettify.js"></script>
<!-- jQuery Tags Input -->
<script src="../vendors/jquery.tagsinput/src/jquery.tagsinput.js"></script>
<!-- Switchery -->
<script src="../vendors/switchery/dist/switchery.min.js"></script>
<!-- Select2 -->
<script src="../vendors/select2/dist/js/select2.full.min.js"></script>
<!-- Parsley -->
<script src="../vendors/parsleyjs/dist/parsley.min.js"></script>
<script src="../vendors/parsleyjs/dist/i18n/fa.js"></script>
<!-- Autosize -->
<script src="../vendors/autosize/dist/autosize.min.js"></script>
<!-- jQuery autocomplete -->
<script src="../vendors/devbridge-autocomplete/dist/jquery.autocomplete.min.js"></script>
<!-- starrr -->
<script src="../vendors/starrr/dist/starrr.js"></script>

<!-- Custom Theme Scripts -->
<script src="../js/custom.js"></script>
<script src="../js/persianumber.js"></script></body>
</html>
